@page
@model soft20181_starter.Pages.Admin.Users.IndexModel
@{
    ViewData["Title"] = "User Management - EventScape";
    Layout = "_Layout";
}

<div class="container my-5">
    <div class="featured-events-header">
        <h2 class="featured-title">User Management</h2>
    </div>
    
    <div class="row mb-4">
        <div class="col text-center">
            <a href="/Admin" class="admin-dashboard-btn">Admin Dashboard</a>
        </div>
    </div>

    <div class="admin-overview-cards mb-5">
        <div class="row">
            <div class="col-md-4">
                <div class="admin-overview-card">
                    <div class="admin-overview-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <div class="admin-overview-content">
                        <a href="#" onclick="openUsersModal('','')" class="stretched-link text-decoration-none">
                            <h3>@Model.TotalUserCount</h3>
                            <p>Total Users (click)</p>
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mt-4 mt-md-0">
                <div class="admin-overview-card">
                    <div class="admin-overview-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="admin-overview-content">
                        <a href="#" onclick="openUsersModal('Administrator','')" class="stretched-link text-decoration-none">
                            <h3>@Model.AdminCount</h3>
                            <p>Administrators (click)</p>
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mt-4 mt-md-0">
                <div class="admin-overview-card">
                    <div class="admin-overview-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="admin-overview-content">
                        <a href="#" onclick="openUsersModal('Standard','')" class="stretched-link text-decoration-none">
                            <h3>@Model.StandardCount</h3>
                            <p>Standard Users (click)</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card admin-card">
        <div class="admin-card-header">
            <div class="admin-card-title"><i class="fas fa-list"></i> Users</div>
        </div>
        <div class="table-responsive">
            <table class="table admin-table">
                <thead class="admin-table-header">
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Roles</th>
                        <th>Registered</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Users.Count == 0)
                    {
                        <tr><td colspan="4" class="text-center">No users found</td></tr>
                    }
                    else
                    {
                        foreach (var u in Model.Users)
                        {
                            <tr class="admin-table-row">
                                <td>@u.Name @u.Surname</td>
                                <td>@u.Email</td>
                                <td>@string.Join(", ", u.UserRoles)</td>
                                <td>@u.RegisteredDate.ToString("yyyy-MM-dd")</td>
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Users Modal -->
    <div class="modal fade" id="usersModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Users</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="usersModalContent">Loading...</div>
          </div>
        </div>
      </div>
    </div>

    <div class="user-management-actions">
        <a asp-page="Create" class="user-action-btn">
            <i class="fas fa-user-plus"></i> Add New User
        </a>
        <a asp-page="SearchForEdit" class="user-action-btn">
            <i class="fas fa-edit"></i> Edit User
        </a>
        <a asp-page="SearchForDelete" class="user-action-btn">
            <i class="fas fa-trash"></i> Delete User
        </a>
        <a href="/Admin/Events" class="user-action-btn">
            <i class="fas fa-calendar-alt"></i> Manage Events
        </a>
        <a href="/Admin" class="user-action-btn">
            <i class="fas fa-tachometer-alt"></i> Dashboard
        </a>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/style.css">
    <link rel="stylesheet" href="~/css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        /* Featured Events title styling from EventDetail */
        .featured-title {
            display: inline-block;
            background-color: #522B5B;
            color: white;
            padding: 15px 30px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 28px;
            margin: 40px auto;
            text-align: center;
        }
        
        .featured-events-header {
            margin-top: 60px;
            text-align: center;
            margin-left: 0;
        }
        
        /* Admin Dashboard Button */
        .admin-dashboard-btn {
            display: inline-block;
            background-color: #854F6C;
            color: white;
            padding: 12px 25px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 10px auto 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .admin-dashboard-btn:hover {
            background-color: #522B5B;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            text-decoration: none;
        }
        
        .admin-overview-cards {
            margin: 30px 0;
        }
        
        .admin-overview-card {
            background-color: #BFACB5;
            border-radius: 8px;
            padding: 30px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            height: 100%;
            margin-bottom: 30px;
        }
        
        .admin-overview-card:hover {
            transform: translateY(-5px);
        }
        
        .admin-overview-icon {
            background-color: #522B5B;
            color: white;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-right: 25px;
        }
        
        .admin-overview-content h3 {
            color: #522B5B;
            font-size: 36px;
            font-weight: bold;
            margin: 0;
        }
        
        .admin-overview-content p {
            color: #522B5B;
            margin: 0;
            font-size: 18px;
            font-weight: 500;
        }
        
        .admin-card {
            border: none;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2) !important;
            margin-top: 30px;
            margin-bottom: 30px !important;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .admin-card-header {
            background-color: #BFACB5;
            color: #522B5B;
            padding: 35px;
            border-bottom: none;
        }
        
        .admin-card-title {
            color: #522B5B;
            font-weight: bold;
            font-size: 24px;
            display: flex;
            align-items: center;
        }
        
        .admin-card-title i {
            font-size: 28px;
            margin-right: 12px;
        }
        
        .admin-search-form {
            width: 100%;
        }
        
        .search-container {
            display: flex;
            align-items: center;
            width: 100%;
            position: relative;
            height: 64px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .search-input {
            flex: 1;
            height: 64px;
            background-color: #BFACB5;
            border: none;
            padding: 0 20px;
            color: #522B5B;
            font-size: 18px;
            width: calc(100% - 64px);
            font-weight: 500;
        }
        
        .search-input::placeholder {
            color: #522B5B;
            opacity: 0.7;
            font-size: 18px;
        }
        
        .search-input:focus {
            outline: none;
        }
        
        .search-button {
            width: 64px;
            height: 64px;
            background-color: #522B5B;
            border: none;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: absolute;
            right: 0;
            top: 0;
            transition: background-color 0.2s ease;
        }
        
        .search-button:hover {
            background-color: #6e3b7a;
        }
        
        .search-button:focus {
            outline: none;
        }
        
        .admin-table {
            margin-bottom: 0;
        }
        
        .admin-table-header {
            background-color: #F3F3F3;
        }
        
        .admin-table-header th {
            color: #522B5B;
            font-weight: bold;
            padding: 20px 25px;
            border-bottom: 2px solid #BFACB5;
            font-size: 17px;
        }
        
        .admin-table-row {
            transition: background-color 0.3s ease;
        }
        
        .admin-table-row:hover {
            background-color: #F9F5F7;
        }
        
        .admin-table-row td {
            vertical-align: middle;
            padding: 20px 25px;
            color: #522B5B;
            font-size: 16px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background-color: #522B5B;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 20px;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 16px;
        }
        
        .admin-badge-admin {
            background-color: #522B5B;
            color: white;
            padding: 7px 14px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .admin-badge-user {
            background-color: #BFACB5;
            color: #522B5B;
            padding: 7px 14px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .admin-action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .admin-btn-edit, 
        .admin-btn-details, 
        .admin-btn-delete {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            font-size: 18px;
        }
        
        .admin-btn-edit {
            background-color: #522B5B;
            color: white;
            border: none;
        }
        
        .admin-btn-edit:hover {
            background-color: #854F6C;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .admin-btn-details {
            background-color: #BFACB5;
            color: #522B5B;
            border: none;
        }
        
        .admin-btn-details:hover {
            background-color: #D8C3CB;
            color: #522B5B;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .admin-btn-delete {
            background-color: #dc3545;
            color: white;
            border: none;
        }
        
        .admin-btn-delete:hover {
            background-color: #c82333;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .admin-no-data {
            padding: 50px;
            text-align: center;
        }
        
        .admin-no-data i {
            font-size: 60px;
            color: #BFACB5;
            display: block;
            margin-bottom: 20px;
        }
        
        .admin-no-data p {
            color: #522B5B;
            font-size: 22px;
            margin: 0;
        }
        
        .admin-pagination {
            margin-top: 25px;
        }
        
        .admin-pagination .page-link {
            color: #522B5B;
            border: 1px solid #BFACB5;
            transition: all 0.3s ease;
            padding: 12px 18px;
            font-size: 16px;
            font-weight: 500;
            margin: 0 3px;
        }
        
        .admin-pagination .page-item.active .page-link {
            background-color: #522B5B;
            border-color: #522B5B;
            color: white;
        }
        
        .admin-pagination .page-link:hover {
            background-color: #BFACB5;
            color: #522B5B;
        }
        
        .admin-card-footer {
            padding: 25px;
            background-color: #f8f9fa;
        }
        
        /* User Management Action Buttons */
        .user-management-actions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px auto 100px;
            max-width: 1200px;
        }
        
        .user-action-btn {
            display: inline-block;
            background-color: #522B5B;
            color: white;
            padding: 15px 30px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            min-width: 250px;
        }
        
        .user-action-btn i {
            margin-right: 10px;
        }
        
        .user-action-btn:hover {
            background-color: #854F6C;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            text-decoration: none;
        }
        
        .container {
            margin-bottom: 100px !important;
            max-width: 1400px;
        }
        
        @@media (max-width: 768px) {
            .mt-md-0 {
                margin-top: 30px !important;
            }
            
            .admin-overview-card {
                margin-bottom: 30px;
            }
            
            .admin-search-input, 
            .admin-search-btn {
                font-size: 14px;
                padding: 10px 15px;
            }
            
            .admin-card-title {
                font-size: 18px;
                margin-bottom: 15px !important;
            }
            
            .featured-title {
                font-size: 24px;
                padding: 12px 20px;
            }
            
            .user-action-btn {
                width: 100%;
                margin-bottom: 10px;
                font-size: 16px;
                padding: 12px 20px;
            }
            
            .user-management-actions {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* Clean search implementation */
        .search-wrapper {
            width: 100%;
            max-width: 600px;
            margin-left: auto;
        }
        
        .search-form {
            width: 100%;
        }
        
        .search-container {
            display: flex;
            align-items: center;
            width: 100%;
            position: relative;
            height: 64px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .search-input {
            flex: 1;
            height: 64px;
            background-color: #BFACB5;
            border: none;
            padding: 0 20px;
            color: #522B5B;
            font-size: 18px;
            width: calc(100% - 64px);
            font-weight: 500;
        }
        
        .search-input::placeholder {
            color: #522B5B;
            opacity: 0.7;
            font-size: 18px;
        }
        
        .search-input:focus {
            outline: none;
        }
        
        .search-button {
            width: 64px;
            height: 64px;
            background-color: #522B5B;
            border: none;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: absolute;
            right: 0;
            top: 0;
            transition: background-color 0.2s ease;
        }
        
        .search-button:hover {
            background-color: #6e3b7a;
        }
        
        .search-button:focus {
            outline: none;
        }
    </style>
}

@section Scripts {
    <script src="~/js/javascript.js"></script>
    <script>
      async function openUsersModal(roleFilter, search) {
        try {
          const params = new URLSearchParams();
          if (roleFilter) params.append('roleFilter', roleFilter);
          if (search) params.append('searchString', search);
          const resp = await fetch(`?handler=UsersJson&${params.toString()}`);
          const data = await resp.json();
          const cont = document.getElementById('usersModalContent');
          if (!data || !data.users || data.users.length === 0) {
            cont.innerHTML = '<div class="text-center p-3">No users found</div>';
          } else {
            const rows = data.users.map(u => `
              <tr>
                <td>${u.name ?? ''} ${u.surname ?? ''}</td>
                <td>${u.email ?? ''}</td>
                <td>${(u.roles||[]).join(', ')}</td>
                <td>${(u.registeredDate||'').toString().substring(0,10)}</td>
              </tr>`).join('');
            cont.innerHTML = `
              <div class="table-responsive">
                <table class="table admin-table">
                  <thead class="admin-table-header">
                    <tr><th>Name</th><th>Email</th><th>Roles</th><th>Registered</th></tr>
                  </thead>
                  <tbody>${rows}</tbody>
                </table>
              </div>`;
          }
          const modal = new bootstrap.Modal(document.getElementById('usersModal'));
          modal.show();
        } catch (e) {
          document.getElementById('usersModalContent').innerHTML = 'Error loading users';
          const modal = new bootstrap.Modal(document.getElementById('usersModal'));
          modal.show();
        }
      }
    </script>
} 